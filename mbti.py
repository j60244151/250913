import random
import textwrap
import streamlit as st

# -------------------- 페이지 & 전역 스타일 --------------------
st.set_page_config(page_title="MBTI 스트레스 해소 비법 🍋", page_icon="🧡", layout="centered")

# 귀여운 노란 테마 + 동글동글
st.markdown("""
<style>
@import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

:root{
  --main:#ffeb3b;      /* 레몬 노랑 */
  --main-dark:#ffd600; /* hover */
  --bg:#fff9e6;        /* 부드러운 크림 */
  --ink:#3d3d3d;       /* 글자색 */
  --card:#fffef6;      /* 카드배경 */
  --accent:#ffb300;    /* 포인트 */
}

html, body, [class*="css"] {
  font-family: 'Jua', sans-serif !important;
  background: var(--bg) !important;
  color: var(--ink) !important;
}

.block-container { padding-top: 2.2rem; max-width: 780px; }

h1, h2, h3 { letter-spacing: .5px; }

/* 라벨/설명 */
label, .stSelectbox label {
  font-size: 20px !important;
  color: var(--accent) !important;
}

/* 버튼 동글동글 */
.stButton>button {
  background: var(--main) !important;
  color: var(--ink) !important;
  border: none !important;
  border-radius: 22px !important;
  padding: 10px 20px !important;
  font-size: 18px !important;
  box-shadow: 0 4px 0 #e6cf00 !important;
}
.stButton>button:hover { background: var(--main-dark) !important; transform: translateY(-1px); }
.stButton>button:active { transform: translateY(2px); box-shadow: 0 2px 0 #e6cf00 !important; }

/* 카드 */
.tip-card{
  background: var(--card);
  border: 2px solid var(--main);
  border-radius: 24px;
  padding: 16px 18px;
  margin: 10px 0 14px 0;
  box-shadow: 0 6px 0 #ffe25a33;
}
.badge{
  display:inline-block; padding:4px 10px; border-radius: 999px;
  background: var(--main); color: var(--ink); margin-right: 6px; font-size: 14px;
}
.small{ font-size: 14px; opacity: .85; }
.footer-note{
  margin-top: 12px; font-size: 14px; color:#6a6a6a
}
hr{ border-top: 2px dashed #ffe07a66; }
</style>
""", unsafe_allow_html=True)

# -------------------- 데이터: MBTI별 디테일 팁 --------------------
# 각 MBTI는 "집콕", "밖콕", "소셜"로 3개씩. 말투는 편한 친구 톤.
TIPS = {
    "ISTJ": [
        ("집콕", "📚 미니 정리 루틴\n1) 책상 위에 ‘버리기/보관/보류’ 상자 3개만 준비해봐.\n2) 서랍 한 칸만 20분 타이머 맞추고 정리하자. 욕심은 금지.\n3) 끝나면 따뜻한 차 한 잔에 책 10쪽. 딱 여기까지만 하자.\n작아도 완성감이 바로 올라가."),
        ("밖콕", "🚶 산책 20분 코스 만들기\n편의점→공원→집 루트를 저장해두고, 걷는 동안 오늘 불편했던 점 3가지를 메모해봐. 돌아와서 메모를 할 일로 쪼개면 머리가 훨씬 가벼워질 거야."),
        ("소셜", "👥 조용한 스터디 2인 모드\n주 1회 30분. 각자 읽은 거 3줄 요약만 공유하고 질문 1개씩. 끝나면 잡담 타임. 안정감 있게 에너지 채우기 좋다.")
    ],
    "ISFJ": [
        ("집콕", "🍪 노오븐 쿠키 힐링\n재료 미리 계량→ 반죽→ 성형까지 30~40분. 굽는 동안은 드라마 1회만 보기. 완성 후 티타임까지가 패키지.\n달콤한 거 하나가 마음을 참 편하게 해."),
        ("밖콕", "🌿 초보 친화 식물 들이기\n화분에 이름/입양일/물 주기 날짜 써서 붙여두자. 2주 후 잎 상태 비교해서 사진 남기면 작지만 뿌듯해."),
        ("소셜", "☎️ 10분 안부 콜\n편한 친구 한 명에게 ‘요즘 어땠어?’ 하고 가볍게 묻고, 칭찬 1개+공감 1개만 얹어서 마무리. 에너지 과투자 없이도 충분히 따뜻해.")
    ],
    "INFJ": [
        ("집콕", "🕯️ 감정 디톡스 3단계\n조명 낮추고 향초 하나 켜기 → 빗소리/숲소리 15분 → 저널링: 오늘 감정 단어 3개, 원인, 다음 행동 1개. 조용히 정돈되는 느낌이 들 거야."),
        ("밖콕", "🌌 별 보기 산책\n별자리 앱 켜서 북두칠성만 찾아보자. 소망 3가지를 말 대신 간단히 적고 주머니에 넣어두기. 돌아오는 길엔 잔잔한 노래로 마무리."),
        ("소셜", "🎬 큐레이션 공유\n요즘 좋았던 문장/영상 1개를 친구에게 공유하고, 왜 좋았는지 5줄 이내로 설명해줘. 강요 없이 ‘필요하면 봐’ 톤이면 딱 좋아.")
    ],
    "INTJ": [
        ("집콕", "🧠 브레인 디버깅(25분)\n문제→가설→실험으로 간단히 트리 그려봐. 가설 A/B 중 오늘은 하나만 테스트. 결과는 140자로 요약하고, 다음 라운드는 내일로 미루자."),
        ("밖콕", "🏃 인터벌 러닝 15분\n1분 빠르게/1분 느리게를 7세트. 시작 전 2km 기준 페이스 기록하고 2주 뒤 다시 측정. 수치로 확인하면 동기부여가 잘 돼."),
        ("소셜", "🧩 전략 보드게임 1판\n스몰토크 대신 플레이에 집중. 끝나고 ‘오늘 내 베스트 한 수’만 공유하고 해산. 자극은 남기고 피로는 줄이자.")
    ],
    "ISTP": [
        ("집콕", "🛠️ 미니 수리 챌린지\n고장 난 물건 하나 정해서 튜토리얼 영상 1개만 보고 30분 안에 1단계까지만. 완벽주의 내려놓고 가볍게 성취감 챙기자."),
        ("밖콕", "🚴 바람쐬기 라이딩\n근처 자전거 대여→ 강변 왕복 10~15km. 돌아와서 스트레칭 5분과 차가운 음료 한 잔. 몸이 풀리면 머리도 풀려."),
        ("소셜", "🎯 액티비티 친구 소환\n볼링/양궁카페/스쿼시 중 하나. 점수 기록하고 소소하게 경쟁해보자. 에너지 전환에 좋아.")
    ],
    "ISFP": [
        ("집콕", "🎨 컬러 3개 드로잉\n30분 타이머 켜고 오늘 끌리는 색 3개만 골라 그림을 그려봐. 레퍼런스 없이 손이 가는 대로. 끝나면 제목 붙여서 벽에 걸어두자."),
        ("밖콕", "☀️ 피크닉 미니 세트\n노란 포인트 소품 하나 챙기고 공원 그늘에 자리 잡기. 하늘 타임랩스 30초 찍고, 집에 와서 음악 살짝 얹어 저장해두면 기분이 오래가."),
        ("소셜", "📸 오늘의 소확행 3컷\n좋았던 순간 3장을 골라 친구와 공유하기. 작은 기쁨을 나누면 만족감이 확 올라가.")
    ],
    "INFP": [
        ("집콕", "📖 감정 일기 확장판\n오늘 있었던 일을 5문장으로 서사처럼 써봐. 마지막 문장은 ‘그래도 나는 내 편이니까’로 마무리. 스스로에게 꽤 힘이 돼."),
        ("밖콕", "🌈 컬러 워킹\n산책하면서 ‘노란 것 10개 찾기’ 게임. 찾을 때마다 감사 한 줄 적기. 생각보다 금방 마음이 밝아져."),
        ("소셜", "💌 따뜻한 DM 1통\n‘요즘 네가 떠올랐어’로 시작해서 구체적 칭찬 1개만 전해줘. 보내고 나에게도 같은 말을 한 번 더 해보자.")
    ],
    "INTP": [
        ("집콕", "🧪 호기심 딥다이브 45분\n관심 주제 하나(예: 수면 최적화)로 아티클 2개만 훑고 메모: 핵심 3줄·의문 1줄·실험 1개. 오늘 바로 실험 시작하기."),
        ("밖콕", "🛰️ 이어폰 없이 걷기 25분\n생각나는 아이디어를 귀가 후 5개만 적고, 그중 1개를 다음 주의 나에게 메일 예약 발송. 자연스럽게 실행으로 이어져."),
        ("소셜", "🧠 ‘왜’ 스터디 10분\n주제 하나를 잡고 질문만 던지는 짧은 토론. 팩트체크는 각자 집에서. 부담이 적어서 꾸준히 하기 좋아.")
    ],
    "ESTP": [
        ("집콕", "🎮 리듬/피트니스 20분\n게임이든 앱이든 가볍게 땀만 내자. 끝나고 시원한 음료로 건배. 에너지 전환에 딱 좋아."),
        ("밖콕", "🏄 액션 체험 1회 예약\n클라이밍/보드 같은 체험형 활동을 한 번만 예약해봐. 그날 밤은 폼롤러로 회복 루틴까지 챙기면 금상첨화."),
        ("소셜", "🎤 명곡 릴레이\n친한 친구들과 애창곡을 한 곡씩 돌아가며 부르기. 과몰입 말고, 시원하게 웃고 끝내는 게 목표.")
    ],
    "ESFP": [
        ("집콕", "💃 홈콘셉트 데이\n드레스코드 ‘노란 포인트’로 정하고, 3곡 셋리스트로 춤추기 → 마지막 곡은 스트레칭용 발라드. 셀카 1장으로 마무리."),
        ("밖콕", "🍨 디저트 투어 2곳\n지도에 카페 두 곳만 찍고 ‘레몬 메뉴’ 비교해보자. 사진에 행복 지수 별점 붙여서 기록하면 나중에 보기 좋아."),
        ("소셜", "🎲 보드게임/마피아\n처음 보는 사람과도 금방 친해지니까 아이스브레이크로 최고. 반응 살짝만 과해도 분위기가 금방 풀려.")
    ],
    "ENFP": [
        ("집콕", "📝 아이디어 보틀\n빈 병에 포스트잇 10장을 접어 넣고 매일 하나 뽑아 실험해봐. 잘 안 돼도 스토리가 남는 게 포인트."),
        ("밖콕", "🛵 랜덤 나들이\n지도를 아무 데나 탭 해서 2km 안 카페/공원에 가보기. 현장에서 좋았던 점 3가지를 음성 메모로 남겨두면 기억에 오래 남아."),
        ("소셜", "👯 스낵 미팅 15분\n짧게 만나 수다 떨고, 끝에 서로에게 칭찬 스티커 1개씩 주고 해산. 가볍게 기분 올리기 좋다.")
    ],
    "ENTP": [
        ("집콕", "🧪 재료 3개 발명놀이\n집에 있는 것들(고무줄, 종이컵, 클립 등) 중 3개를 조합해서 쓸모 있어 보이는 장난감 만들기. 15초 영상으로 기록까지."),
        ("밖콕", "🚶 ‘역순 루트’ 산책\n평소 경로를 반대로 걸어보면서 새로 보이는 점 5가지를 찾아보자. 뇌가 새로 고침되는 느낌이 있어."),
        ("소셜", "⚖️ 토론 스파링 10분\n주제를 하나 정하고 중간에 찬반을 바꿔보는 연습. 유연성이 올라가면 스트레스가 의외로 많이 줄어들어.")
    ],
    "ESTJ": [
        ("집콕", "📅 주간 캘린더 개편\n색 규칙: 노랑=내 일, 회색=대기. ‘정지 업무’ 리스트 만들고 바로 2개 처리해보자. 눈앞이 좀 시원해질 거야."),
        ("밖콕", "🏋️ 3종 근력 루틴 15분\n푸시업/스쿼트/플랭크 각 3세트. 기록 시트에 횟수를 남기면 다음에 더 쉽게 올라간다."),
        ("소셜", "👥 팀 브런치 20분 브리핑\n각자 이번 주 우선순위 1개와 리스크 1개만 공유하고 끝. 깔끔하게 정리되면 마음도 편해져.")
    ],
    "ESFJ": [
        ("집콕", "🍲 케어 쿠킹 대용량\n소스나 반찬을 3끼 분량으로 소분하고 라벨에 유통기한을 적어두자. 나도 챙기고 주변도 챙기는 느낌이 좋아."),
        ("밖콕", "🌼 플리마켓 구경\n가벼운 대화와 칭찬을 주고받다 보면 기분이 금방 올라가. 예쁜 엽서 한 장 사서 누군가에게 선물해도 좋고."),
        ("소셜", "📞 행복 인터뷰 5분\n상대에게 오늘 좋았던 순간 1가지만 물어보고 진심으로 리액션. 나도 덩달아 밝아진다.")
    ],
    "ENFJ": [
        ("집콕", "🗺️ 관계지도 리셋\n중요한 사람 5명을 적고, 고마웠던 점과 다음에 해보고 싶은 일 1줄씩. 여기서 1명만 골라 간단히 연락해보자."),
        ("밖콕", "🎥 소극장/작은 영화관\n관람 후 ‘한 줄 감상’만 나누고 파해치지는 않기. 가볍게 연결되면 충분해."),
        ("소셜", "🎮 협동 게임 1판\n목표는 승리가 아니라 서로 살리기. 칭찬 5회 달성하면 미션 클리어. 분위기 좋아진다.")
    ],
    "ENTJ": [
        ("집콕", "📊 미니 KPI 3개\n이번 주 핵심 지표 3개만 정해서 트래커에 체크(예: 수면시간/운동/집중시간). 지표가 보이면 마음이 정리돼."),
        ("밖콕", "🥊 하이 인텐시브 30분\n복싱/스핀 같은 운동 1회. 끝나고 단백질 스무디 한 잔으로 마무리. 과하게 길게 하지 않는 게 포인트."),
        ("소셜", "🧑‍✈️ 브레인트러스트 20분\n믿을 만한 친구 2명과 의사결정 1건만 리뷰. 피드백을 메모로 정리하고 액션 1개를 바로 확정해보자.")
    ],
}

ALL_TYPES = list(TIPS.keys())

# -------------------- 헤더 --------------------
st.title("🍋 MBTI 스트레스 해소 추천")
st.caption("노란 톤의 가벼운 추천 3가지. 오늘은 가볍게 하나만 실천해보자 🙂")

colA, colB = st.columns([2,1])
with colA:
    mbti = st.selectbox("👉 MBTI를 선택해줘", ALL_TYPES, index=ALL_TYPES.index("ENFP") if "ENFP" in ALL_TYPES else 0)
with colB:
    vibe = st.radio("분위기", ["차분하게 🍋", "가볍게 신나게 🎉"], index=0)

scope = st.multiselect("원하는 활동 타입(선택 안 하면 랜덤 추천)", ["집콕", "밖콕", "소셜"])

# -------------------- 추천 로직 --------------------
def pick_tips(mbti_key: str, want_tags):
    items = TIPS[mbti_key]
    if want_tags:
        items = [x for x in items if x[0] in want_tags] or TIPS[mbti_key]
    k = min(3, len(items))
    return random.sample(items, k)

def render_tip(idx, tag, text):
    st.markdown(f"""
    <div class="tip-card">
      <span class="badge">{'🏠' if tag=='집콕' else '🌳' if tag=='밖콕' else '👥'} {tag}</span>
      <span class="badge">Tip {idx+1}</span>
      <div style="margin-top:8px; white-space:pre-wrap;">{textwrap.fill(text, width=60)}</div>
      <div class="footer-note">작게 시작하면 금방 가벼워져. 오늘은 하나만 해보자.</div>
    </div>
    """, unsafe_allow_html=True)

# -------------------- 메인 액션 --------------------
if st.button("추천 받기 🍋"):
    st.balloons()
    picks = pick_tips(mbti, scope)

    intro = "천천히 차분하게 가보자." if "차분" in vibe else "가볍게 기분 전환해보자!"
    st.subheader(f"{mbti}에게 맞춘 3가지")
    st.write(intro)

    for i, (tg, txt) in enumerate(picks):
        render_tip(i, tg, txt)

    # 다운로드용 텍스트
    full_text = f"[{mbti}] 스트레스 해소 3가지\n" + "\n\n".join([f"({tg}) {txt}" for tg, txt in picks])
    st.download_button("📝 메모로 저장(UTF-8)", data=full_text, file_name=f"{mbti}_stress_tips.txt")

# 푸터
st.markdown("<hr/>", unsafe_allow_html=True)
st.markdown("_Tip_: 과하게 길게 하지 말고, 오늘은 부담 없는 것 1개만. 내일의 나도 충분히 괜찮아. 😊")
