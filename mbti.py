import random
import textwrap
import streamlit as st

# -------------------- 페이지 & 전역 스타일 --------------------
st.set_page_config(page_title="MBTI 스트레스 해소 비법 🐶💛", page_icon="🐾", layout="centered")

# 귀여운 노란 테마 + 동글동글
st.markdown("""
<style>
@import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

:root{
  --main:#ffeb3b;      /* 레몬 노랑 */
  --main-dark:#ffd600; /* hover */
  --bg:#fff9e6;        /* 부드러운 크림 */
  --ink:#3d3d3d;       /* 글자색 */
  --card:#fffef6;      /* 카드배경 */
  --accent:#ffb300;    /* 포인트 */
}

html, body, [class*="css"] {
  font-family: 'Jua', sans-serif !important;
  background: var(--bg) !important;
  color: var(--ink) !important;
}

/* 전체 컨테이너 조금 넓게 */
.block-container { padding-top: 2.2rem; max-width: 780px; }

/* 타이틀 */
h1, h2, h3 { letter-spacing: .5px; }

/* 셀렉트박스 라벨 */
label, .stSelectbox label {
  font-size: 20px !important;
  color: var(--accent) !important;
}

/* 버튼 동글동글 */
.stButton>button {
  background: var(--main) !important;
  color: var(--ink) !important;
  border: none !important;
  border-radius: 22px !important;
  padding: 10px 20px !important;
  font-size: 18px !important;
  box-shadow: 0 4px 0 #e6cf00 !important;
}
.stButton>button:hover { background: var(--main-dark) !important; transform: translateY(-1px); }
.stButton>button:active { transform: translateY(2px); box-shadow: 0 2px 0 #e6cf00 !important; }

/* 카드 */
.tip-card{
  background: var(--card);
  border: 2px solid var(--main);
  border-radius: 24px;
  padding: 16px 18px;
  margin: 10px 0 14px 0;
  box-shadow: 0 6px 0 #ffe25a33;
}
.badge{
  display:inline-block; padding:4px 10px; border-radius: 999px;
  background: var(--main); color: var(--ink); margin-right: 6px; font-size: 14px;
}
.small{ font-size: 14px; opacity: .85; }
.footer-note{
  margin-top: 12px; font-size: 14px; color:#6a6a6a
}
hr{ border-top: 2px dashed #ffe07a66; }
</style>
""", unsafe_allow_html=True)

# -------------------- 데이터: MBTI별 디테일 팁 --------------------
# 각 항목은 "집콕", "밖콕", "소셜" 태그 포함. 길고 구체적으로, 밈 톤 유지.
TIPS = {
    "ISTJ": [
        ("집콕", "📚 정리왕 플로우 가자 멍! \n1) 책상 위 ‘정리 3종 세트(버리기/보관/보류)’ 박스 만들기\n2) 오늘 서랍 한 칸만 공략→ 타이머 20분 세팅 ⏱️\n3) 끝나면 차 한 잔 우려서 읽던 책 10쪽만! 성취감 체크 ✅\n듀 강아지 인증샷 각? #갓생 #작지만확실한성취"),
        ("밖콕", "🚶‍♂️ 루틴 산책 미션! \n1) 집 앞 20분 코스 저장(편의점→공원→집)\n2) 보행 리듬에 맞춰 ‘불편-해결’ 생각 정리(메모 3줄)\n3) 돌아와서 메모를 Todo로 쪼개기📋\nㄹㅇ 머리 개맑아짐."),
        ("소셜", "👥 ‘책 또래’ 소규모 스터디 딱 2명만! \n1) 주1회 30분, 각자 요약 3줄 공유\n2) 질문 1개씩만, 잡담 금지(끝나고 수다 타임 허용ㅋㅋ)\n안전지대형 소셜 충전 완료 🧯")
    ],
    "ISFJ": [
        ("집콕", "🍪 베이킹 힐링 루틴(노오븐 쿠키 가능) \n1) 재료 미리 계량해 트레이에 귀엽게 정렬\n2) 굽는 동안 좋아하는 드라마 ‘1회차만’ 시청 📺\n3) 완성 후 따뜻한 차+쿠키로 셀프 티타임 ☕\n마음 구석구석 포근해짐."),
        ("밖콕", "🌿 식물 가드닝 데이 \n1) 동네 꽃집 가서 ‘초보 친화’ 식물 1종 입양\n2) 화분 라벨에 이름/입양일/물주기 적기\n3) 2주 후 잎 상태 비교 인증샷 남기면 듀가 칭찬 멍멍 🐶✨"),
        ("소셜", "☎️ 케어콜 10분 컷 \n1) 편한 친구 1명에게 ‘근황 3줄’ 음성메시지 보내기\n2) 답장 오면 ‘칭찬 1, 공감 1, 제안 0~1’ 구조로 회신\n너무 착한 너, 에너지 과투자 방지룰로 가볍게만!")
    ],
    "INFJ": [
        ("집콕", "🕯️ 감성 디톡스 리추얼 \n1) 조명 30%로 낮추고 향초 하나 켜기\n2) 백색소음(빗소리/숲소리) 틀고 15분 명상\n3) 저널링: 오늘 ‘감정 단어’ 3개 → 원인 → 다음 액션 1개 ✍️"),
        ("밖콕", "🌌 별 보기 산책 \n1) 맨눈 별자리 앱 켜고 북두칠성 찾기\n2) 3가지 소망을 말 대신 메모로 적고 바람에 흔들기\n3) 귀갓길엔 느린 노래로 엔딩 크레딧 BGM 🎧"),
        ("소셜", "🎬 큐레이션 나눔 \n1) 요즘 나를 살린 문장/영상 1개 공유\n2) ‘왜 좋았는지’ 5줄 이하로 설명\n3) 강요 노노, ‘필요하면 봐!’ 톤으로. X 감성 한 스푼 🫶")
    ],
    "INTJ": [
        ("집콕", "🧠 브레인 디버깅 스프린트(25분) \n1) 스트레스 원인 트리(문제→가설→실험) 그리기\n2) 가설 A·B 중 실험 1개만 오늘 실행\n3) 결과는 140자 요약. 다음 라운드는 내일로 미룸. 과부하 차단!"),
        ("밖콕", "🏃 성과지향 러닝 \n1) 2km 테스트 → 평균 페이스 기록\n2) 주 2회 15분 인터벌(1분 빠르게/1분 느리게)\n3) 2주 뒤 리테스트로 그래프 확인 📈 도파민 직결."),
        ("소셜", "🧩 스몰토크 방지형 보드게임 모임 \n1) 전략/추론 게임 1판 완주\n2) 끝나고 ‘오늘의 베스트 무브’만 공유\n사교 피로 최소화+자극 최대치, ㄹㅇ 합리적.")
    ],
    "ISTP": [
        ("집콕", "🛠️ 미니 수리/개조 챌린지 \n1) 고장 난 물건 하나 골라 유튜브 1개 튜토만 시청\n2) 필요한 공구/부품 체크리스트 작성\n3) 30분 안에 1단계까지만! 오버 금지. 성취감 챙기자 👨‍🔧"),
        ("밖콕", "🚴 바람쐬기 스프린트 \n1) 근처 자전거 대여소→강변 왕복 10~15km\n2) 귀가 후 스트레칭 5분 + 아이스 음료 한 잔 🧊\n몸 풀리면 머리도 풀림."),
        ("소셜", "🎯 액티비티 친구 한 명 소환 \n볼링/양궁카페/스쿼시 중 랜덤 1개 픽 → 스코어 기록\n승부욕으로 스트레스 증발 ㄱㄱ!")
    ],
    "ISFP": [
        ("집콕", "🎨 감성 드로잉 세션 \n1) 30분 타이머 켜고 오늘의 색 3개만 고르기\n2) 레퍼런스 금지, 손이 가는 대로\n3) 끝나면 작품에 제목 붙이고 벽에 살포시 전시 🖼️"),
        ("밖콕", "☀️ 햇살 피크닉 \n1) 노란 돗자리+샌드위치 포장\n2) 공원 그늘 베이스캠프 설치, 하늘 타임랩스 30초 찍기\n3) 귀가 후 영상에 음악 깔고 릴 업로드(비공개도 ok)"),
        ("소셜", "📸 ‘오늘의 소확행 3컷’ 공유 \n나만의 미학 공유하면 칭찬 샤워 옴. 듀 강아지가 개추 누름 🐶👍")
    ],
    "INFP": [
        ("집콕", "📖 감정 일기 확장판 \n1) 오늘의 ‘서사’ 5문장 쓰기\n2) 마지막 문장은 ‘내가 내 편이라서 다행이야’로 마무리\n3) 배경엔 lo-fi 플레이리스트로 잔망 잔잔템 🎧"),
        ("밖콕", "🌈 컬러 워킹 \n1) ‘노란 것 10개 찾기’ 미션 들고 산책\n2) 찾을 때마다 한 줄 감사 적기\n감정 온도 올라간다, ㄹㅇ임."),
        ("소셜", "💌 따뜻한 DM 1통 \n‘요즘 너 생각났어’로 시작→ 구체적 칭찬 1개 → 부담 0 마무리\n보내고 스스로에게도 같은 말 한 번 더 하기 🫶")
    ],
    "INTP": [
        ("집콕", "🧪 호기심 딥다이브 45분 \n1) 궁금한 한 주제(예: 수면 최적화) 논문/아티클 2개 스캔\n2) 메모: ‘핵심 3줄·의문 1줄·실험 1개’\n3) 실험 오늘 당장 시작(취침 30분 전 스크린 off 등)"),
        ("밖콕", "🛰️ 사색 산책(무계획 존중) \n이어폰 없이 25분 걷기 → 돌아와서 떠오른 아이디어 5개 브레인덤프\n이 중 1개만 내주 나에게 메일 예약발송 📬"),
        ("소셜", "🧠 ‘왜’ 스터디 \n주제 하나 잡고(예: 커피가 뇌에 미치는 영향) 10분만 토론\n근데 팩트체크는 각자 집에 가서 하기. 여기선 질문만!")
    ],
    "ESTP": [
        ("집콕", "🎮 리듬 폭발 홈파티(솔로도 가능) \n댄스 게임/피트니스 앱 20분 스테이지 → 냉장고 음료로 셀프 건배 🥤\n하이파이브는 듀랑… 에어로라도 함 가자 🙌"),
        ("밖콕", "🏄‍♂️ 액션 미션 \n1) 번지/보드/클라이밍 중 근처 체험 1회 예약\n2) 그날 저녁엔 폼롤러+마사지건으로 회복 루틴 💆‍♂️"),
        ("소셜", "🎤 노래방 ‘찐 명예곡’ 챌린지 \n팀 짜서 애창곡 리그전 → MVP는 레몬 사탕 수여 🍋\n기승전 스트레스 0화.")
    ],
    "ESFP": [
        ("집콕", "💃 드레스업 홈콘 \n1) 오늘의 드레스코드: ‘노랑 포인트’\n2) 거울 앞 3곡 셋리스트로 춤추기 → 마지막 곡은 발라드로 쿨다운\n3) 셀카 1장 남기고 스스로에게 하트 날리기 💛"),
        ("밖콕", "🍨 디저트 투어\n지도에 카페 2곳 찍고 베스트 레몬 메뉴 뽑기\n사진에 ‘행복 지수’ 5점 만점 평가 스티커 붙이기 ⭐"),
        ("소셜", "🎲 보드게임/마피아 소셜데이 \n초면도 금방 친해지는 너의 필드! ‘리액션 왕’ 뱃지 노린다 👑")
    ],
    "ENFP": [
        ("집콕", "📝 아이디어 스파크 보틀 \n빈 병 하나에 포스트잇 아이디어 10장 접어 넣기\n하루 하나 뽑아 실험 → 실패해도 스토리 생김. 그게 포인트임 🔥"),
        ("밖콕", "🛵 랜덤 나들이 \n지도 랜덤 탭 → 2km 안 카페/공원 즉흥 방문\n현장에서 ‘좋았던 3가지’ 음성메모 남기기 🎙️"),
        ("소셜", "👯 친구 소환 스낵 미팅 \n15분 드롭인 수다 → 끝에 서로에게 칭찬 스티커 1장씩 지급\n기분 급등각 ⬆️")
    ],
    "ENTP": [
        ("집콕", "🧪 장난감 발명 1-Day \n집에 굴러다니는 재료 3개 조합(고무줄+종이컵+클립 등)\n‘쓸모 없는 듯 쓸모 있는’ 무언가 만들기 → 영상 15초로 기록"),
        ("밖콕", "🚶‍♂️ ‘반대로 걷기’ 실험 \n평소 루트 역순으로 걸으며 관찰 포인트 5개 찾기\n뇌가 새로 고침됨. 진짜임."),
        ("소셜", "⚖️ 토론 스파링 10분 컷 \n주제 랜덤 뽑기 → 찬반 변경 스위치 사용(중간에 입장 바꾸기)\n유연성 올리고 스트레스 내리고~")
    ],
    "ESTJ": [
        ("집콕", "📅 컨트롤 타워 모드 \n1) 이번 주 캘린더 전면 개편(색상 규칙: 노랑=나, 회색=대기)\n2) 15분 ‘정지 업무’ 리스트 만들고 바로 2개 처리 🚀"),
        ("밖콕", "🏋️ 근력 3대 15분 루틴 \n푸시업/스쿼트/플랭크 각 3세트 → 기록 시트에 횟수 적기\n수치가 말해준다. 내가 바로 성취 머신."),
        ("소셜", "👥 팀 브런치 브리핑 \n각자 이번 주 우선순위 1개+리스크 1개만 공유\n회의 20분 컷. 깔끔 그 자체.")
    ],
    "ESFJ": [
        ("집콕", "🍲 케어 쿠킹 \n1) 대용량 미트/야채 소스 만들어 3끼 분량 소분\n2) 스티커에 유통기한/조리법 적기 → 나와 친구를 동시에 케어 ✨"),
        ("밖콕", "🌼 플리마켓/벼룩 구경 \n소소한 대화+칭찬 주고받기만 해도 옥시토신 뿜뿜\n예쁜 엽서 한 장 쟁여서 누군가에게 선물 ㄱㄱ"),
        ("소셜", "📞 ‘행복 인터뷰’ 5분 \n상대에게 오늘 좋았던 순간 1개 물어보기 → 진심으로 리액션\n본인 기분도 같이 올라감. 듀가 보장 🐶")
    ],
    "ENFJ": [
        ("집콕", "🗺️ 관계지도 리셋 \n핵심 사람 5명 리스트업 → ‘고마웠던 점·다음에 할 일’ 1줄씩\nDM 1통만 보내도 에너지 흐름이 살아난다 ✉️"),
        ("밖콕", "🎥 커뮤니티 무비데이(작게) \n집 근처 소극장/작은 영화관 픽 → 관람 후 ‘한 줄 감상’ 나눔\n리더십 ON, 부담은 OFF."),
        ("소셜", "🎮 협동 게임 1판 \n목표는 승리가 아니라 ‘서로 살리기’. 칭찬 콤보 5회 달성하면 미션 클리어 🏆")
    ],
    "ENTJ": [
        ("집콕", "📊 미니 KPI 리부트 \n이번 주 핵심 3지표만 선정(수면시간/운동분/딥워크분 등)\n트래커 만들어 데일리 체크 → 승률 올리자 📈"),
        ("밖콕", "🥊 파워 스트레스 방전 \n복싱 PT/스핀 30분 같은 하이 인텐시브 하나 박고\n단백질 스무디로 마무리. 그게 바로 내 길."),
        ("소셜", "🧑‍✈️ ‘브레인 트러스트’ 20분 \n능력 믿는 친구 2명 소환 → 의사결정 사안 1개만 리뷰\n피드백 받아 액션 1개 즉시 확정. 깔끔.")
    ],
}

ALL_TYPES = list(TIPS.keys())

# -------------------- 헤더 --------------------
st.title("🍋 멍멍~ 듀 강아지의 MBTI 스트레스 해소소 🍋")
st.caption("최신 밈 톤으로 기분 업! ‘집콕/밖콕/소셜’ 중 랜덤으로 3가지 찜해줄게요 🐶✨")

colA, colB = st.columns([2,1])
with colA:
    mbti = st.selectbox("👉 너 MBTI 뭐냐 멍? (솔직 고백 ㄱㄱ)", ALL_TYPES, index=ALL_TYPES.index("ENFP") if "ENFP" in ALL_TYPES else 0)
with colB:
    vibe = st.radio("분위기", ["아기레몬 차분🍋", "하이텐션 펀🎉"], index=1)

scope = st.multiselect("선호 활동 타입(선택 안 하면 랜덤 추천!)", ["집콕", "밖콕", "소셜"])

# -------------------- 추천 로직 --------------------
def pick_tips(mbti_key: str, want_tags):
    items = TIPS[mbti_key]
    if want_tags:
        items = [x for x in items if x[0] in want_tags] or TIPS[mbti_key]
    # 3개 뽑되, 부족하면 중복 없이 가능한 만큼
    k = min(3, len(items))
    return random.sample(items, k)

def render_tip(idx, tag, text):
    st.markdown(f"""
    <div class="tip-card">
      <span class="badge">{'🏠' if tag=='집콕' else '🌳' if tag=='밖콕' else '👥'} {tag}</span>
      <span class="badge">Tip {idx+1}</span>
      <div style="margin-top:8px; white-space:pre-wrap;">{textwrap.fill(text, width=60)}</div>
      <div class="footer-note">🐶 듀 코멘트: 이거 하고 나면 텐션 ↑ 컨디션 ↑ 기분은 레몬처럼 상큼해짐 🍋</div>
    </div>
    """, unsafe_allow_html=True)

# -------------------- 메인 액션 --------------------
if st.button("추천 받기 💛 멍!"):
    st.balloons()
    picks = pick_tips(mbti, scope)

    intro_fun = "헤이 헤이~ 에너지 부스터 온! 🔥" if "하이텐션" in vibe else "차분 모드로 부드럽게 간다 멍… 🫧"
    st.subheader(f"{mbti}에게 찰떡 맞춤 3콤보 나간다 멍! 🐾")
    st.write(intro_fun)

    # 카드 렌더링
    for i, (tg, txt) in enumerate(picks):
        render_tip(i, tg, txt)

    # 클립보드/다운로드용 텍스트
    full_text = f"[{mbti}] 스트레스 해소 3콤보🐶\n" + "\n\n".join([f"({tg}) {txt}" for tg, txt in picks])
    st.download_button("📝 메모장으로 저장(UTF-8)", data=full_text, file_name=f"{mbti}_stress_tips_du_dog.txt")

    # 작은 리마인드
    st.info("작게, 가볍게, 오늘 1개만! 내일의 내가 고맙다고 박수침 👏")

# 푸터
st.markdown("<hr/>", unsafe_allow_html=True)
st.markdown("**듀 강아지 한마디:** “과하지 않게 한 입씩! 꾸준함이 레전드 만든다 멍~” 🐶🍋")
